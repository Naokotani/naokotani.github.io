
<!doctype html>
<html lang="en">


<head>
  <meta charset="UTF-8" />
  <title>Nuts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Chris Hughes&#39; developer blog focused on web development, programming, and technology." />
  <link rel="stylesheet" type="text/css" href="/static/css/normalize.css">
  <link rel="stylesheet" type="text/css" href="/static/css/vars.css">
  <link rel="stylesheet" type="text/css" href="/static/css/styles.css">
  <script>
    const theme = localStorage.getItem("pref-theme")
    if (theme === "dark") {
      document.documentElement.style.background = "#141414";
    } else if (theme === "light") {
      document.documentElement.style.background = "#fefefe";
    } else {
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.style.background = "#141414";
      } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
        document.documentElement.style.background = "#fefefe";
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Libre&#43;Baskerville&amp;family=Source&#43;Sans&#43;Pro&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="shortcut icon" type="image/png" href="/static/icons/favicon-16x16.png" />
  <link rel="alternate" type="application/rss+xml" title="Nuts" href="/rss">
  <script src="/static/js/colors.js" defer></script>
  <script src="/static/js/menu.js" defer></script>
</head>


<header class="desktop">
  <nav>
    <a href="/">
      <h2>Chris Hughes dot Dev</h2>
    </a>
    <div class="social-links">
    
      <a href="/resume/resume.html">Resume</a>
    
    
      <a href="/about/about.html">About</a>
    
      
      <a href="https://github.com/Naokotani" target="_blank" rel="noopener noreferrer">
        GitHub
      </a>
      
      
      <a href="mailto: chris@chris-hughes.dev">
        <svg class="icon nav-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 640 640"><path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/></svg>
      </a>
      
      
      <a href="/rss.xml">
        <svg class="icon nav-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 640 640"><path d="M96 128C96 110.3 110.3 96 128 96C357.8 96 544 282.2 544 512C544 529.7 529.7 544 512 544C494.3 544 480 529.7 480 512C480 317.6 322.4 160 128 160C110.3 160 96 145.7 96 128zM96 480C96 444.7 124.7 416 160 416C195.3 416 224 444.7 224 480C224 515.3 195.3 544 160 544C124.7 544 96 515.3 96 480zM128 224C287.1 224 416 352.9 416 512C416 529.7 401.7 544 384 544C366.3 544 352 529.7 352 512C352 388.3 251.7 288 128 288C110.3 288 96 273.7 96 256C96 238.3 110.3 224 128 224z"/></svg>
      </a>
      
      <button id="theme-toggle">
        <svg class="icon nav-icon" id="moon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M303.3 112.7C196.2 121.2 112 210.8 112 320C112 434.9 205.1 528 320 528C353.3 528 384.7 520.2 412.6 506.3C309.2 482.9 232 390.5 232 280C232 214.2 259.4 154.9 303.3 112.7zM64 320C64 178.6 178.6 64 320 64C339.4 64 358.4 66.2 376.7 70.3C386.6 72.5 394 80.8 395.2 90.8C396.4 100.8 391.2 110.6 382.1 115.2C321.5 145.4 280 207.9 280 280C280 381.6 362.4 464 464 464C469 464 473.9 463.8 478.8 463.4C488.9 462.6 498.4 468.2 502.6 477.5C506.8 486.8 504.6 497.6 497.3 504.6C451.3 548.8 388.8 576 320 576C178.6 576 64 461.4 64 320z"/></svg>
        <svg class="icon nav-icon" id="bulb" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M424.5 355.1C449 329.2 464 294.4 464 256C464 176.5 399.5 112 320 112C240.5 112 176 176.5 176 256C176 294.4 191 329.2 215.5 355.1C236.8 377.5 260.4 409.1 268.8 448L371.2 448C379.6 409 403.2 377.5 424.5 355.1zM459.3 388.1C435.7 413 416 443.4 416 477.7L416 496C416 540.2 380.2 576 336 576L304 576C259.8 576 224 540.2 224 496L224 477.7C224 443.4 204.3 413 180.7 388.1C148 353.7 128 307.2 128 256C128 150 214 64 320 64C426 64 512 150 512 256C512 307.2 492 353.7 459.3 388.1zM272 248C272 261.3 261.3 272 248 272C234.7 272 224 261.3 224 248C224 199.4 263.4 160 312 160C325.3 160 336 170.7 336 184C336 197.3 325.3 208 312 208C289.9 208 272 225.9 272 248z"/></svg>
      </button>
    </div>
  </nav>
</header>
<header class="mobile">
  <nav>
    <a href="/">
      <h2>Chris Hughes.Dev</h2>
    </a>
    <a href="javascript:void(0);" onclick="handleSocial()">
      <i class="fa fa-bars menu"></i>
    </a>
  </nav>
</header>
<div id="social-menu" style="display: none;">
  <div class="mobile-social">
    <a href="/rss">
      <svg xmlns="http://www.w2.org/2000/svg" fill="currentColor" viewBox="0 0 640 640"><path d="M96 128C96 110.3 110.3 96 128 96C357.8 96 544 282.2 544 512C544 529.7 529.7 544 512 544C494.3 544 480 529.7 480 512C480 317.6 322.4 160 128 160C110.3 160 96 145.7 96 128zM96 480C96 444.7 124.7 416 160 416C195.3 416 224 444.7 224 480C224 515.3 195.3 544 160 544C124.7 544 96 515.3 96 480zM128 224C287.1 224 416 352.9 416 512C416 529.7 401.7 544 384 544C366.3 544 352 529.7 352 512C352 388.3 251.7 288 128 288C110.3 288 96 273.7 96 256C96 238.3 110.3 224 128 224z"/></svg>
    </a>
    
    <a href="mailto: chris@chris-hughes.dev">
      <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 640 640"><path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/></svg>
    </a>
    
    
    <a href="https://github.com/Naokotani" target="_blank" rel="noopener noreferrer">
      <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M237.9 461.4C237.9 463.4 235.6 465 232.7 465C229.4 465.3 227.1 463.7 227.1 461.4C227.1 459.4 229.4 457.8 232.3 457.8C235.3 457.5 237.9 459.1 237.9 461.4zM206.8 456.9C206.1 458.9 208.1 461.2 211.1 461.8C213.7 462.8 216.7 461.8 217.3 459.8C217.9 457.8 216 455.5 213 454.6C210.4 453.9 207.5 454.9 206.8 456.9zM251 455.2C248.1 455.9 246.1 457.8 246.4 460.1C246.7 462.1 249.3 463.4 252.3 462.7C255.2 462 257.2 460.1 256.9 458.1C256.6 456.2 253.9 454.9 251 455.2zM316.8 72C178.1 72 72 177.3 72 316C72 426.9 141.8 521.8 241.5 555.2C254.3 557.5 258.8 549.6 258.8 543.1C258.8 536.9 258.5 502.7 258.5 481.7C258.5 481.7 188.5 496.7 173.8 451.9C173.8 451.9 162.4 422.8 146 415.3C146 415.3 123.1 399.6 147.6 399.9C147.6 399.9 172.5 401.9 186.2 425.7C208.1 464.3 244.8 453.2 259.1 446.6C261.4 430.6 267.9 419.5 275.1 412.9C219.2 406.7 162.8 398.6 162.8 302.4C162.8 274.9 170.4 261.1 186.4 243.5C183.8 237 175.3 210.2 189 175.6C209.9 169.1 258 202.6 258 202.6C278 197 299.5 194.1 320.8 194.1C342.1 194.1 363.6 197 383.6 202.6C383.6 202.6 431.7 169 452.6 175.6C466.3 210.3 457.8 237 455.2 243.5C471.2 261.2 481 275 481 302.4C481 398.9 422.1 406.6 366.2 412.9C375.4 420.8 383.2 435.8 383.2 459.3C383.2 493 382.9 534.7 382.9 542.9C382.9 549.4 387.5 557.3 400.2 555C500.2 521.8 568 426.9 568 316C568 177.3 455.5 72 316.8 72zM169.2 416.9C167.9 417.9 168.2 420.2 169.9 422.1C171.5 423.7 173.8 424.4 175.1 423.1C176.4 422.1 176.1 419.8 174.4 417.9C172.8 416.3 170.5 415.6 169.2 416.9zM158.4 408.8C157.7 410.1 158.7 411.7 160.7 412.7C162.3 413.7 164.3 413.4 165 412C165.7 410.7 164.7 409.1 162.7 408.1C160.7 407.5 159.1 407.8 158.4 408.8zM190.8 444.4C189.2 445.7 189.8 448.7 192.1 450.6C194.4 452.9 197.3 453.2 198.6 451.6C199.9 450.3 199.3 447.3 197.3 445.4C195.1 443.1 192.1 442.8 190.8 444.4zM179.4 429.7C177.8 430.7 177.8 433.3 179.4 435.6C181 437.9 183.7 438.9 185 437.9C186.6 436.6 186.6 434 185 431.7C183.6 429.4 181 428.4 179.4 429.7z"/></svg>
    </a>
    
    
    <a href="/resume/resume.html">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 640 640"><path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/></svg>
    </a>
    
    <button id="theme-toggle-mobile">
        <svg id="moon-mobile" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M303.3 112.7C196.2 121.2 112 210.8 112 320C112 434.9 205.1 528 320 528C353.3 528 384.7 520.2 412.6 506.3C309.2 482.9 232 390.5 232 280C232 214.2 259.4 154.9 303.3 112.7zM64 320C64 178.6 178.6 64 320 64C339.4 64 358.4 66.2 376.7 70.3C386.6 72.5 394 80.8 395.2 90.8C396.4 100.8 391.2 110.6 382.1 115.2C321.5 145.4 280 207.9 280 280C280 381.6 362.4 464 464 464C469 464 473.9 463.8 478.8 463.4C488.9 462.6 498.4 468.2 502.6 477.5C506.8 486.8 504.6 497.6 497.3 504.6C451.3 548.8 388.8 576 320 576C178.6 576 64 461.4 64 320z"/></svg>
        <svg id="bulb-mobile" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M424.5 355.1C449 329.2 464 294.4 464 256C464 176.5 399.5 112 320 112C240.5 112 176 176.5 176 256C176 294.4 191 329.2 215.5 355.1C236.8 377.5 260.4 409.1 268.8 448L371.2 448C379.6 409 403.2 377.5 424.5 355.1zM459.3 388.1C435.7 413 416 443.4 416 477.7L416 496C416 540.2 380.2 576 336 576L304 576C259.8 576 224 540.2 224 496L224 477.7C224 443.4 204.3 413 180.7 388.1C148 353.7 128 307.2 128 256C128 150 214 64 320 64C426 64 512 150 512 256C512 307.2 492 353.7 459.3 388.1zM272 248C272 261.3 261.3 272 248 272C234.7 272 224 261.3 224 248C224 199.4 263.4 160 312 160C325.3 160 336 170.7 336 184C336 197.3 325.3 208 312 208C289.9 208 272 225.9 272 248z"/></svg>
    </button>
  </div>
</div>

<div id="contentDiv" class="contentDiv">

<summary>
  Creating a text editor in C using rope-like data structure.
</summary>
<h1>Nuts</h1>
<p><small class="date">Published: 8 Oct 2025 at 09:42 ADT</small></p>
<p><small class="tech">C | Unity | GCC</small></p>
<div id="outline-container-org227ea24" class="outline-2">
<h2 id="org227ea24">What&rsquo;s NUTS?</h2>
<div class="outline-text-2" id="text-org227ea24">
<p>
<a href="https://github.com/Naokotani/nuts">NUTS</a>, Naokotani&rsquo;s Unusable Text Software (I am also playing with the idea of PEANUTS, Portable Executable Application: Naokotani&rsquo;s Unusable Text Software), is my new hobby coding project to create a rudimentary TUI text editor similar to Vi or Nano in C. The plan is to create a text editor that stores text in a <a href="https://en.wikipedia.org/wiki/Rope_(data_structure)">rope-like</a> data structure based on logical text divisions; buffers, lines and words (&ldquo;words&rdquo; are really text snippets, they can be punctuation, white space, etc.). A linked list of buffers (IE, vim, Emacs buffers etc.) points to linked lists of lines, which point to linked lists of words, which contain the strings that make up the text buffer. The intention is not to create the latest greatest vscode competitor, but to do a deep dive into strategies to store text in computers at a relatively low level.
</p>
</div>
</div>
<div id="outline-container-orgd0c15c7" class="outline-2">
<h2 id="orgd0c15c7">Why This?</h2>
<div class="outline-text-2" id="text-orgd0c15c7">
<p>
I was recently doing some work implementing a simple linked list in C along with associated functions for working with the data structure. The basic implementation was not very interesting, so I decided to see what other interesting directions I could take the code in. Initially the linked list stored integers, but I started to play with storing dynamic character pointers in the linked list. Next I implemented the functions as Clojure inspired recursive functions (functions like first, rest). Once I had this working with small basic hard coded strings,  I created a few simple functions to parse text and place it into my linked list. I fed it some books like the King James Bible and Moby Dick (no rhyme or reason here, its just what came up on Project Gutenberg), and to my utter shock and horror,  it instantly crashed with a segmentation fault. The issue was that the recursive functions were causing stack overflows when I was feeding them these longer texts (I believe Moby Dick parsed out to somewhere around 280 000 words and the program got to around 90 000 and got very sad). After some investigation I found that GCC actually supports tail call optimizations as long as you pass the -O2 flag and the return of the recursive function is the last piece of logic in the function. In order to make the tail call optimization work, I had to jump through some hoops and the code got a bit messy, but it worked, and performed pretty well. I didn&rsquo;t bench mark it, but it was able to parse Moby Dick, put it in a linked list, a recursively copy the list to pull out a random quote in a split second.
</p>

<p>
This project, while interesting, didn&rsquo;t feel like it was going anywhere. I would like to spruce up the UI a little bit for creating quotes, but programs that do nothing put pull random quotes out of .txt files are not exactly in hot demand at the moment. Furthermore, the tail call optimization was fun to explore, but I had to bend over backwards to conform the functions to it&rsquo;s requirements. I do think that there are niche situations where it might be helpful, so its nice to know how it works and some of the pitfalls of recursion in C, but there are costs associated with it as well.
</p>

<p>
I realized at some point that what I had was already an extremely rudimentary form of text editor. It could only operate on words and couldn&rsquo;t manipulate white space, but I was able to make arbitrary changes to long passages of text fairly efficiently. By extending the idea up from the word to the line and buffer and down from the word to the character I realized I could create a rudimentary text editor with the knowledge I had gained. More surprisingly, this happened to be at least approximately how text editors often actually work. Sadly, the recursive functions wouldn&rsquo;t make it to the next step. There is already infinite complexity to explore within the paradigm of a text editor without needing to arbitrarily complicate it.
</p>
</div>
</div>
<div id="outline-container-org89638c7" class="outline-2">
<h2 id="org89638c7">Where is NUTS in the Nowness of time?</h2>
<div class="outline-text-2" id="text-org89638c7">
<p>
So far I have created the basic project structure using a template provided by <a href="https://github.com/ThrowTheSwitch/Unity">Unity</a> testing framework and created the basic outline of the types I will need. I have started working primarily in <a href="https://github.com/Naokotani/nuts/blob/main/src/Word.c">Word.c</a> where I am building out the functions needed to manipulate strings. The ability to add and delete characters and to add and remove regions of text. The following snippet gives a good overview of my approach and is pulled largely from my <code>addString()</code> function in <code>Word.c</code>.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #51587a;">// </span><span style="color: #51587a;">Save the start index.</span>
<span style="color: #c0caf5;">int</span> <span style="color: #c0caf5;">index</span> = startIndex;

<span style="color: #51587a;">// </span><span style="color: #51587a;">Get length of the sub string to copy over from the</span>
<span style="color: #51587a;">// </span><span style="color: #51587a;">difference of the indicies</span>
<span style="color: #c0caf5;">int</span> <span style="color: #c0caf5;">length</span> = endIndex - startIndex;

<span style="color: #51587a;">// </span><span style="color: #51587a;">Decrement the startIndex until it reaches zero. Increment</span>
<span style="color: #51587a;">// </span><span style="color: #51587a;">and copy the derefenced pointer to the new string.</span>
<span style="color: #bb9af7;">while</span> <span style="color: #a9b1d6;">(</span>startIndex-- &amp;&amp; <span style="color: #7aa2f7;">(</span>*newStrPtr++ = *oldStrPtr++<span style="color: #7aa2f7;">)</span><span style="color: #a9b1d6;">)</span>
    ;

<span style="color: #51587a;">// </span><span style="color: #51587a;">Copy the newStr from the new string passed as an argument to the fuction.</span>
<span style="color: #51587a;">// </span><span style="color: #51587a;">Because the pointer was already incremented and hasn't been reset, its</span>
<span style="color: #51587a;">// </span><span style="color: #51587a;">already in the correct postion to start copying.</span>
<span style="color: #bb9af7;">while</span> <span style="color: #a9b1d6;">(</span><span style="color: #7aa2f7;">(</span>*newStrPtr++ = *inputString++<span style="color: #7aa2f7;">)</span><span style="color: #a9b1d6;">)</span>
    ;

<span style="color: #51587a;">// </span><span style="color: #51587a;">Increment the index by the length of the copied String.</span>
<span style="color: #51587a;">// </span><span style="color: #51587a;">This can be used to determine how much if any of the old</span>
<span style="color: #51587a;">// </span><span style="color: #51587a;">string remains to be copied.</span>
index += length;

<span style="color: #51587a;">// </span><span style="color: #51587a;">I need to decrement here because the pointer is after the '\0'</span>
<span style="color: #51587a;">// </span><span style="color: #51587a;">character because of the final increment after the while fails in</span>
<span style="color: #51587a;">// </span><span style="color: #51587a;">the preceeding loop.</span>
incNew--;

<span style="color: #51587a;">// </span><span style="color: #51587a;">If more of the string remains, append it to the to new string</span>
<span style="color: #51587a;">// </span><span style="color: #51587a;">I could also use a while loop, but strcpy internally uses the</span>
<span style="color: #51587a;">// </span><span style="color: #51587a;">same approach, so it works well to tack on the last bit.</span>
<span style="color: #bb9af7;">if</span> <span style="color: #a9b1d6;">(</span>index &lt; <span style="color: #7aa2f7;">(</span><span style="color: #c0caf5;">int</span><span style="color: #7aa2f7;">)</span>word-&gt;size<span style="color: #a9b1d6;">)</span> <span style="color: #a9b1d6;">{</span>
    oldStrPtr += length;
    strcpy<span style="color: #7aa2f7;">(</span>incNew, incOld<span style="color: #7aa2f7;">)</span>;
<span style="color: #a9b1d6;">}</span>

</pre>
</div>

<p>
I took this logic for copying strings from &ldquo;The C Programming Language&rdquo; by K &amp; R (especially pages 86-88), which describes the logic in detail and is an interesting read. I could make more liberal use of memset or strcpy, but especially in the case of strcpy, the implementation used in the GCC source code uses a nearly identical approach, so I don&rsquo;t think there is  huge advantage to using them over simple while loops. This approach makes it easier to save the position of the pointer for further operations. The function to delete a region of a string uses the same approach. It copies up the start index, increments the pointer by end index minus start index and copies what, if anything, remains after the deleted region.
</p>
</div>
</div>
<div id="outline-container-org81f8156" class="outline-2">
<h2 id="org81f8156">What about Performance!</h2>
<div class="outline-text-2" id="text-org81f8156">
<p>
After doing a bit reading about ropes, I realized that they tend to be immutable and favor statically sized arrays, while my implementation uses malloc to assign memory to the character pointers. This prompted me to do a little bit of investigating with some very rudimentary benchmarking programs.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #7dcfff; font-weight: bold;">#define</span> <span style="color: #c0caf5;">ITERATIONS</span> <span style="color: #ff9e64; font-weight: bold;">1000000</span>

<span style="color: #c0caf5;">int</span> <span style="color: #7aa2f7;">main</span><span style="color: #a9b1d6;">(</span><span style="color: #c0caf5;">void</span><span style="color: #a9b1d6;">)</span> <span style="color: #a9b1d6;">{</span>
    <span style="color: #c0caf5;">char</span> <span style="color: #c0caf5;">testTemplate</span><span style="color: #7aa2f7;">[]</span> = <span style="color: #9ece6a;">"Hello, World!"</span>;
    <span style="color: #c0caf5;">float</span> <span style="color: #c0caf5;">fixedStartTime</span> = <span style="color: #7aa2f7;">(</span><span style="color: #c0caf5;">float</span><span style="color: #7aa2f7;">)</span>clock<span style="color: #7aa2f7;">()</span> / <span style="color: #ff9e64;">CLOCKS_PER_SEC</span>;

    <span style="color: #bb9af7;">for</span> <span style="color: #7aa2f7;">(</span><span style="color: #c0caf5;">int</span> <span style="color: #c0caf5;">i</span> = <span style="color: #ff9e64; font-weight: bold;">0</span>; i &lt; <span style="color: #ff9e64;">ITERATIONS</span>; i++<span style="color: #7aa2f7;">)</span> <span style="color: #7aa2f7;">{</span>
        <span style="color: #c0caf5;">char</span> <span style="color: #c0caf5;">testChar</span><span style="color: #ff9e64;">[</span><span style="color: #ff9e64; font-weight: bold;">14</span><span style="color: #ff9e64;">]</span>;
        strcpy<span style="color: #ff9e64;">(</span>testChar, testTemplate<span style="color: #ff9e64;">)</span>;
    <span style="color: #7aa2f7;">}</span>

    <span style="color: #c0caf5;">float</span> <span style="color: #c0caf5;">fixedEndTime</span> = <span style="color: #7aa2f7;">(</span><span style="color: #c0caf5;">float</span><span style="color: #7aa2f7;">)</span>clock<span style="color: #7aa2f7;">()</span> / <span style="color: #ff9e64;">CLOCKS_PER_SEC</span>;
    <span style="color: #c0caf5;">float</span> <span style="color: #c0caf5;">fixedTimeElapsed</span> = fixedEndTime - fixedStartTime;
    <span style="color: #c0caf5;">float</span> <span style="color: #c0caf5;">mallocStartTime</span> = <span style="color: #7aa2f7;">(</span><span style="color: #c0caf5;">float</span><span style="color: #7aa2f7;">)</span>clock<span style="color: #7aa2f7;">()</span> / <span style="color: #ff9e64;">CLOCKS_PER_SEC</span>;

    <span style="color: #bb9af7;">for</span> <span style="color: #7aa2f7;">(</span><span style="color: #c0caf5;">int</span> <span style="color: #c0caf5;">i</span> = <span style="color: #ff9e64; font-weight: bold;">0</span>; i &lt; <span style="color: #ff9e64;">ITERATIONS</span>; i++<span style="color: #7aa2f7;">)</span> <span style="color: #7aa2f7;">{</span>
        <span style="color: #c0caf5;">char</span> *<span style="color: #c0caf5;">testChar</span> = malloc<span style="color: #ff9e64;">(</span><span style="color: #ff9e64; font-weight: bold;">14</span> * <span style="color: #bb9af7;">sizeof</span><span style="color: #73daca;">(</span><span style="color: #c0caf5;">char</span><span style="color: #73daca;">)</span><span style="color: #ff9e64;">)</span>;
        strcpy<span style="color: #ff9e64;">(</span>testChar, testTemplate<span style="color: #ff9e64;">)</span>;
    <span style="color: #7aa2f7;">}</span>

    <span style="color: #c0caf5;">float</span> <span style="color: #c0caf5;">mallocEndTime</span> = <span style="color: #7aa2f7;">(</span><span style="color: #c0caf5;">float</span><span style="color: #7aa2f7;">)</span>clock<span style="color: #7aa2f7;">()</span> / <span style="color: #ff9e64;">CLOCKS_PER_SEC</span>;
    <span style="color: #c0caf5;">float</span> <span style="color: #c0caf5;">mallocTimeElapsed</span> = mallocEndTime - mallocStartTime;

    printf<span style="color: #7aa2f7;">(</span><span style="color: #9ece6a;">"Fixed time elapsed: %f\n"</span>, fixedTimeElapsed<span style="color: #7aa2f7;">)</span>;
    printf<span style="color: #7aa2f7;">(</span><span style="color: #9ece6a;">"Malloc time elapsed: %f\n"</span>, mallocTimeElapsed<span style="color: #7aa2f7;">)</span>;
    <span style="color: #bb9af7;">return</span> <span style="color: #ff9e64; font-weight: bold;">0</span>;
<span style="color: #a9b1d6;">}</span>
</pre>
</div>

<p>
This created an output on my laptop of approximately 0.002 seconds for copying the fixed size array and 0.02 seconds for the malloc version without any compiler optimizations (I also tried it with calloc, which  was slightly slower, but the difference was quite negligible). This is a huge difference in performance between the two, but its not really a realistic scenario, and there are a lot of other considerations.
</p>

<p>
For example, either the fixed arrays would need to be quite large, yet often would only need to hold a small number of characters, or they would be small and then it would be a common scenario where they would need to be split into multiple nodes in the rope structure to hold single blocks of text. Operations that print a single word might require multiple string copies distributed between multiple nodes. That being said, I do think it is likely that you could find a sweet spot where the array was not too large, but in which the vast majority of words could fit. Additionally, making strings dynamically sized greatly simplifies higher level navigation functions such as next word, delete word etc. If strings were distributed across multiple nodes, even very infrequently, a next word function would need to be able to navigate multiple nodes until it determined it was at the node that held the end of the string for the word.
</p>

<p>
I attempt to mitigate this problem somewhat by over sizing the memory allocated to the strings with malloc. The <code>addChar()</code> and <code>delChar()</code> functions, theoretically the ones that will be used for normal one-character-at-a-time (IE. regular typing vs. a put-from-kill-ring style function for example), will only need to resize the buffer once every n number of inputs where n is the <code>BUFFER_SIZE</code> defined. If adding a new character would make the word size equal to a multiple of <code>BUFFER_SIZE</code>, reallocarray is used to resize the buffer appropriately by increasing its size by <code>BUFFER_SIZE</code>.  Later on it will be interesting to play with that value and see how it would perform in different real world scenarios, but for now I&rsquo;m left only speculating. Out of curiosity, I made a similar program and, without compiler optimizations, it was able to put a single character in a static and dynamic char array using array indexing 100 million times, and while the static array was faster, the difference was trivial. Let&rsquo;s just say I don&rsquo;t think you will notice a big difference unless you spend WAY too much time on monkeytype.com.
</p>

<p>
All this speculating is interesting, but ultimately largely academic because performance should be well within the range of the acceptable even for very large text files, and certainly more than acceptable for an unusable text software interface. Right now my biggest concern is creating functioning logic so I can start to work on the myriad problems of user input, saving, loading, managing buffers and so on.
</p>
</div>
</div>


</div>

<footer>
  <div>
    <a href="/">Home</a>
    <a href="mailto: chris@chris-hughes.dev">Email</a>
    <div>
      <small>&copy; Chris Hughes 2025</small>
    </div>
  </div>
</footer>

</html>
