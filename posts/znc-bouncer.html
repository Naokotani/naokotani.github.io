
<!doctype html>
<html lang="en">


<head>
  <meta charset="UTF-8" />
  <title>ZNC Bouncer with Doom Emacs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Chris Hughes&#39; developer blog focused on web development, programming, and technology." />
  <link rel="stylesheet" type="text/css" href="/static/css/normalize.css">
  <link rel="stylesheet" type="text/css" href="/static/css/vars.css">
  <link rel="stylesheet" type="text/css" href="/static/css/styles.css">
  <script>
    const theme = localStorage.getItem("pref-theme")
    if (theme === "dark") {
      document.documentElement.style.background = "#141414";
    } else if (theme === "light") {
      document.documentElement.style.background = "#fefefe";
    } else {
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.style.background = "#141414";
      } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
        document.documentElement.style.background = "#fefefe";
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Libre&#43;Baskerville&amp;family=Source&#43;Sans&#43;Pro&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="shortcut icon" type="image/png" href="/static/icons/favicon-16x16.png" />
  <link rel="alternate" type="application/rss+xml" title="ZNC Bouncer with Doom Emacs" href="/rss">
  <script src="/static/js/colors.js" defer></script>
  <script src="/static/js/menu.js" defer></script>
</head>


<header class="desktop">
  <nav>
    <a href="/">
      <h2>Chris Hughes dot Dev</h2>
    </a>
    <div class="social-links">
    
      <a href="/resume/resume.html">Resume</a>
    
    
      <a href="/about/about.html">About</a>
    
      
      <a href="https://github.com/Naokotani" target="_blank" rel="noopener noreferrer">
        GitHub
      </a>
      
      
      <a href="mailto: chris@chris-hughes.dev">
        <svg class="icon nav-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 640 640"><path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/></svg>
      </a>
      
      
      <a href="/rss.xml">
        <svg class="icon nav-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 640 640"><path d="M96 128C96 110.3 110.3 96 128 96C357.8 96 544 282.2 544 512C544 529.7 529.7 544 512 544C494.3 544 480 529.7 480 512C480 317.6 322.4 160 128 160C110.3 160 96 145.7 96 128zM96 480C96 444.7 124.7 416 160 416C195.3 416 224 444.7 224 480C224 515.3 195.3 544 160 544C124.7 544 96 515.3 96 480zM128 224C287.1 224 416 352.9 416 512C416 529.7 401.7 544 384 544C366.3 544 352 529.7 352 512C352 388.3 251.7 288 128 288C110.3 288 96 273.7 96 256C96 238.3 110.3 224 128 224z"/></svg>
      </a>
      
      <button id="theme-toggle">
        <svg class="icon nav-icon" id="moon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M303.3 112.7C196.2 121.2 112 210.8 112 320C112 434.9 205.1 528 320 528C353.3 528 384.7 520.2 412.6 506.3C309.2 482.9 232 390.5 232 280C232 214.2 259.4 154.9 303.3 112.7zM64 320C64 178.6 178.6 64 320 64C339.4 64 358.4 66.2 376.7 70.3C386.6 72.5 394 80.8 395.2 90.8C396.4 100.8 391.2 110.6 382.1 115.2C321.5 145.4 280 207.9 280 280C280 381.6 362.4 464 464 464C469 464 473.9 463.8 478.8 463.4C488.9 462.6 498.4 468.2 502.6 477.5C506.8 486.8 504.6 497.6 497.3 504.6C451.3 548.8 388.8 576 320 576C178.6 576 64 461.4 64 320z"/></svg>
        <svg class="icon nav-icon" id="bulb" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M424.5 355.1C449 329.2 464 294.4 464 256C464 176.5 399.5 112 320 112C240.5 112 176 176.5 176 256C176 294.4 191 329.2 215.5 355.1C236.8 377.5 260.4 409.1 268.8 448L371.2 448C379.6 409 403.2 377.5 424.5 355.1zM459.3 388.1C435.7 413 416 443.4 416 477.7L416 496C416 540.2 380.2 576 336 576L304 576C259.8 576 224 540.2 224 496L224 477.7C224 443.4 204.3 413 180.7 388.1C148 353.7 128 307.2 128 256C128 150 214 64 320 64C426 64 512 150 512 256C512 307.2 492 353.7 459.3 388.1zM272 248C272 261.3 261.3 272 248 272C234.7 272 224 261.3 224 248C224 199.4 263.4 160 312 160C325.3 160 336 170.7 336 184C336 197.3 325.3 208 312 208C289.9 208 272 225.9 272 248z"/></svg>
      </button>
    </div>
  </nav>
</header>
<header class="mobile">
  <nav>
    <a href="/">
      <h2>Chris Hughes.Dev</h2>
    </a>
    <a href="javascript:void(0);" onclick="handleSocial()">
      <i class="fa fa-bars menu"></i>
    </a>
  </nav>
</header>
<div id="social-menu" style="display: none;">
  <div class="mobile-social">
    <a href="/rss">
      <svg xmlns="http://www.w2.org/2000/svg" fill="currentColor" viewBox="0 0 640 640"><path d="M96 128C96 110.3 110.3 96 128 96C357.8 96 544 282.2 544 512C544 529.7 529.7 544 512 544C494.3 544 480 529.7 480 512C480 317.6 322.4 160 128 160C110.3 160 96 145.7 96 128zM96 480C96 444.7 124.7 416 160 416C195.3 416 224 444.7 224 480C224 515.3 195.3 544 160 544C124.7 544 96 515.3 96 480zM128 224C287.1 224 416 352.9 416 512C416 529.7 401.7 544 384 544C366.3 544 352 529.7 352 512C352 388.3 251.7 288 128 288C110.3 288 96 273.7 96 256C96 238.3 110.3 224 128 224z"/></svg>
    </a>
    
    <a href="mailto: chris@chris-hughes.dev">
      <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 640 640"><path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/></svg>
    </a>
    
    
    <a href="https://github.com/Naokotani" target="_blank" rel="noopener noreferrer">
      <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M237.9 461.4C237.9 463.4 235.6 465 232.7 465C229.4 465.3 227.1 463.7 227.1 461.4C227.1 459.4 229.4 457.8 232.3 457.8C235.3 457.5 237.9 459.1 237.9 461.4zM206.8 456.9C206.1 458.9 208.1 461.2 211.1 461.8C213.7 462.8 216.7 461.8 217.3 459.8C217.9 457.8 216 455.5 213 454.6C210.4 453.9 207.5 454.9 206.8 456.9zM251 455.2C248.1 455.9 246.1 457.8 246.4 460.1C246.7 462.1 249.3 463.4 252.3 462.7C255.2 462 257.2 460.1 256.9 458.1C256.6 456.2 253.9 454.9 251 455.2zM316.8 72C178.1 72 72 177.3 72 316C72 426.9 141.8 521.8 241.5 555.2C254.3 557.5 258.8 549.6 258.8 543.1C258.8 536.9 258.5 502.7 258.5 481.7C258.5 481.7 188.5 496.7 173.8 451.9C173.8 451.9 162.4 422.8 146 415.3C146 415.3 123.1 399.6 147.6 399.9C147.6 399.9 172.5 401.9 186.2 425.7C208.1 464.3 244.8 453.2 259.1 446.6C261.4 430.6 267.9 419.5 275.1 412.9C219.2 406.7 162.8 398.6 162.8 302.4C162.8 274.9 170.4 261.1 186.4 243.5C183.8 237 175.3 210.2 189 175.6C209.9 169.1 258 202.6 258 202.6C278 197 299.5 194.1 320.8 194.1C342.1 194.1 363.6 197 383.6 202.6C383.6 202.6 431.7 169 452.6 175.6C466.3 210.3 457.8 237 455.2 243.5C471.2 261.2 481 275 481 302.4C481 398.9 422.1 406.6 366.2 412.9C375.4 420.8 383.2 435.8 383.2 459.3C383.2 493 382.9 534.7 382.9 542.9C382.9 549.4 387.5 557.3 400.2 555C500.2 521.8 568 426.9 568 316C568 177.3 455.5 72 316.8 72zM169.2 416.9C167.9 417.9 168.2 420.2 169.9 422.1C171.5 423.7 173.8 424.4 175.1 423.1C176.4 422.1 176.1 419.8 174.4 417.9C172.8 416.3 170.5 415.6 169.2 416.9zM158.4 408.8C157.7 410.1 158.7 411.7 160.7 412.7C162.3 413.7 164.3 413.4 165 412C165.7 410.7 164.7 409.1 162.7 408.1C160.7 407.5 159.1 407.8 158.4 408.8zM190.8 444.4C189.2 445.7 189.8 448.7 192.1 450.6C194.4 452.9 197.3 453.2 198.6 451.6C199.9 450.3 199.3 447.3 197.3 445.4C195.1 443.1 192.1 442.8 190.8 444.4zM179.4 429.7C177.8 430.7 177.8 433.3 179.4 435.6C181 437.9 183.7 438.9 185 437.9C186.6 436.6 186.6 434 185 431.7C183.6 429.4 181 428.4 179.4 429.7z"/></svg>
    </a>
    
    
    <a href="/resume/resume.html">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 640 640"><path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/></svg>
    </a>
    
    <button id="theme-toggle-mobile">
        <svg id="moon-mobile" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M303.3 112.7C196.2 121.2 112 210.8 112 320C112 434.9 205.1 528 320 528C353.3 528 384.7 520.2 412.6 506.3C309.2 482.9 232 390.5 232 280C232 214.2 259.4 154.9 303.3 112.7zM64 320C64 178.6 178.6 64 320 64C339.4 64 358.4 66.2 376.7 70.3C386.6 72.5 394 80.8 395.2 90.8C396.4 100.8 391.2 110.6 382.1 115.2C321.5 145.4 280 207.9 280 280C280 381.6 362.4 464 464 464C469 464 473.9 463.8 478.8 463.4C488.9 462.6 498.4 468.2 502.6 477.5C506.8 486.8 504.6 497.6 497.3 504.6C451.3 548.8 388.8 576 320 576C178.6 576 64 461.4 64 320z"/></svg>
        <svg id="bulb-mobile" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M424.5 355.1C449 329.2 464 294.4 464 256C464 176.5 399.5 112 320 112C240.5 112 176 176.5 176 256C176 294.4 191 329.2 215.5 355.1C236.8 377.5 260.4 409.1 268.8 448L371.2 448C379.6 409 403.2 377.5 424.5 355.1zM459.3 388.1C435.7 413 416 443.4 416 477.7L416 496C416 540.2 380.2 576 336 576L304 576C259.8 576 224 540.2 224 496L224 477.7C224 443.4 204.3 413 180.7 388.1C148 353.7 128 307.2 128 256C128 150 214 64 320 64C426 64 512 150 512 256C512 307.2 492 353.7 459.3 388.1zM272 248C272 261.3 261.3 272 248 272C234.7 272 224 261.3 224 248C224 199.4 263.4 160 312 160C325.3 160 336 170.7 336 184C336 197.3 325.3 208 312 208C289.9 208 272 225.9 272 248z"/></svg>
    </button>
  </div>
</div>

<div id="contentDiv" class="contentDiv">

<summary>
  How to set up a ZNC IRC bouncer and connect with a Doom Emacs client.
</summary>
<h1>ZNC Bouncer with Doom Emacs</h1>
<p><small class="date">Published: 8 Oct 2025 at 11:02 ADT</small></p>
<p><small class="tech">IRC | ZNC | Nginx | Docker</small></p>
<p>
IRC is a great chat protocol, but it has some annoying limitations when compared to other modern chat protocols. First and foremost, it lacks the ability to see messages that are sent on servers when you are not connected to a server via a client. Messages are sent to your client when you are connected, but there is no obvious way to log messages that are sent while you are offline. This means that when you log into a server you might come into the middle of an existing conversation with no context, or if you send someone a direct message and then log off, they have no way to send you a response until you log back on to the server again.  Luckily there is an excellent, if not entirely straightforward or ergonomic, solution to this. The IRC bouncer.
</p>
<div id="outline-container-orgc32fbf9" class="outline-2">
<h2 id="orgc32fbf9">What is an IRC Bouncer?</h2>
<div class="outline-text-2" id="text-orgc32fbf9">
<p>
In simple terms,  an IRC bouncer is  an application that is able to connect to one or more IRC servers, such as <a href="https://libera.chat/">Libera Chat</a>, and sending and receiving messages via the IRC protocol in a similar way to a regular IRC client. There are some key distinctions though. An IRC bouncer is designed to be connected to an IRC server continuously and is able to log messages that are sent when we aren&rsquo;t connected with a client.  Another distinction is that when we connect with an IRC client, our username, or nickname,  is registered with the server.  This means that our  nickname will be unavailable if we try to connect again with another client. The workaround to this is that clients provide the functionality to define aliases or backup user names that look very similar to our normal user name, but are slightly different. For example, if my normal user name is <code>Naokotani</code>, I could log in as <code>Naokotani~</code> from a second client and people will most likely be able to deduce who I am. Still, people don&rsquo;t know <i>for sure</i> that it is you, and it is a bit jarring to many of us that are accustomed other modern chat software where logging in with the same username from different clients is common place.
</p>

<p>
IRC bouncers pose a solution to this problem. Instead of logging into a server separately from different clients, the IRC bouncer logs into the server once with our nickname and stays logged in. The bouncer then acts as a proxy that we can connect to multiple times from different clients and, as far as the server is concerned, we have only logged in once.
</p>

<p>
IRC bouncers also solve the problem of missed messages. They are able to log messages that you miss while you are not connected with a client because they are connected all the time. The bouncer can log messages and use a &ldquo;playback&rdquo; to show you the messages that were sent while you were not connected. This is similar to other chat software that will use a horizontal rule to separate the messages that you have &ldquo;seen&rdquo; from those that were sent while you were away.
</p>
</div>
</div>
<div id="outline-container-org4a14df4" class="outline-2">
<h2 id="org4a14df4">My Setup</h2>
<div class="outline-text-2" id="text-org4a14df4">
<p>
As is customary with open protocols like IRC, there are many ways to implement this functionality. In my case I opted to host a <a href="https://wiki.znc.in/ZNC">ZNC</a> bouncer on a VPS, in my case I used <a href="https://www.digitalocean.com/">Digital Ocean</a>, but any provider should suffice, run it in <a href="https://hub.docker.com/_/znc/">Docker</a>, reverse proxy it with <a href="https://nginx.org/">Nginx</a> and then connect to it from <a href="https://github.com/doomemacs/doomemacs">Doom Emacs</a> using the Emacs <a href="https://github.com/emacs-circe/circe">Circe</a> client, the default IRC client for Doom Emacs.
</p>

<p>
These selections are somewhat arbitrary, but  determined by infrastructure that I  had set up previously for other projects, and there are many viable alternatives to these. <a href="https://soju.im/">Soju</a> is a popular alternative to ZNC that you might want to check out. I am using Nginx as the reverse proxy for my setup and, while it is very capable of performing this task well, Nginx can be a little bit arcane and hard to setup. <a href="https://caddyserver.com/">Caddy</a> is another popular choice for a reverse proxy. It is generally easier to setup and has built-in automatic SSL. If you don&rsquo;t like Docker for whatever reason, you can always use <a href="https://podman.io/">Podman</a>, or of course you can just run the bouncer directly on your host machine. As for clients, you could also use <a href="https://www.gnu.org/software/emacs/erc.html">ERC</a>, a CLI app like <a href="https://weechat.org/">Weechat</a>, or a GUI client like <a href="https://apps.gnome.org/Polari/">Polari</a>. I could digress and talk about all of these, but there are enough moving parts here already that it&rsquo;s best we get to it.
</p>
</div>
</div>
<div id="outline-container-orgf606bdf" class="outline-2">
<h2 id="orgf606bdf">Running ZNC</h2>
<div class="outline-text-2" id="text-orgf606bdf">
<p>
The first step is to get ZNC itself running on your machine. You can do this in two simple commands. First run:
</p>
<div class="org-src-container">
<pre class="src src-bash">docker run -it -v znc-cfg:/znc-data znc --makeconf
</pre>
</div>

<p>
This will pull the official ZNC image if it&rsquo;s not on your machine, create a persistent volume for the ZNC configuration data called <code>znc-cfg</code>, run it with an interactive terminal, the <code>-it</code> part, and then run ZNC with the <code>--makeconf</code> flag which, as the name suggestions, will setup an initial configuration file.
</p>

<p>
When you do this you will be prompted to make some initial configuration entries. You should get prompts that look like this.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span> -- Global settings --
<span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span>
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Listen on port <span style="color: #a9b1d6;">(</span><span style="color: #ff9e64; font-weight: bold;">1025</span> to <span style="color: #ff9e64; font-weight: bold;">65534</span><span style="color: #a9b1d6;">)</span>: <span style="color: #ff9e64; font-weight: bold;">12345</span>
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Listen using SSL <span style="color: #a9b1d6;">(</span>yes/no<span style="color: #a9b1d6;">)</span> <span style="color: #a9b1d6;">[</span>no<span style="color: #a9b1d6;">]</span>:
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Listen using both IPv4 and IPv6 <span style="color: #a9b1d6;">(</span>yes/no<span style="color: #a9b1d6;">)</span> <span style="color: #a9b1d6;">[</span>yes<span style="color: #a9b1d6;">]</span>:
<span style="color: #a9b1d6;">[</span> .. <span style="color: #a9b1d6;">]</span> Verifying the listener...
<span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span> Unable to locate pem file: <span style="color: #a9b1d6;">[</span>/znc-data/znc.pem<span style="color: #a9b1d6;">]</span>, creating it
<span style="color: #a9b1d6;">[</span> .. <span style="color: #a9b1d6;">]</span> Writing Pem file <span style="color: #a9b1d6;">[</span>/znc-data/znc.pem<span style="color: #a9b1d6;">]</span>...
<span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span> Enabled global modules <span style="color: #a9b1d6;">[</span>corecaps, saslplainauth, webadmin<span style="color: #a9b1d6;">]</span>
<span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span>
<span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span> -- Admin user settings --
<span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span>
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Username <span style="color: #a9b1d6;">(</span>alphanumeric<span style="color: #a9b1d6;">)</span>: User
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Enter password:
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Confirm password:
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Nick <span style="color: #a9b1d6;">[</span>User<span style="color: #a9b1d6;">]</span>:
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Alternate nick <span style="color: #a9b1d6;">[</span>User_<span style="color: #a9b1d6;">]</span>:
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Ident <span style="color: #a9b1d6;">[</span>User<span style="color: #a9b1d6;">]</span>:
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Real name <span style="color: #a9b1d6;">(</span>optional<span style="color: #a9b1d6;">)</span>:
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Bind host <span style="color: #a9b1d6;">(</span>optional<span style="color: #a9b1d6;">)</span>:
<span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span> Enabled user modules <span style="color: #a9b1d6;">[</span>chansaver, controlpanel<span style="color: #a9b1d6;">]</span>
<span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span>
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Set up a network? <span style="color: #a9b1d6;">(</span>yes/no<span style="color: #a9b1d6;">)</span> <span style="color: #a9b1d6;">[</span>yes<span style="color: #a9b1d6;">]</span>:
<span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span>
<span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span> -- Network settings --
<span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span>
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Name <span style="color: #a9b1d6;">[</span>libera<span style="color: #a9b1d6;">]</span>:
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Server host <span style="color: #a9b1d6;">[</span>irc.libera.chat<span style="color: #a9b1d6;">]</span>:
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Server uses SSL? <span style="color: #a9b1d6;">(</span>yes/no<span style="color: #a9b1d6;">)</span> <span style="color: #a9b1d6;">[</span>yes<span style="color: #a9b1d6;">]</span>: yes
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Server port <span style="color: #a9b1d6;">(</span><span style="color: #ff9e64; font-weight: bold;">1</span> to <span style="color: #ff9e64; font-weight: bold;">65535</span><span style="color: #a9b1d6;">)</span> <span style="color: #a9b1d6;">[</span><span style="color: #ff9e64; font-weight: bold;">6697</span><span style="color: #a9b1d6;">]</span>:
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Server password <span style="color: #a9b1d6;">(</span>probably empty<span style="color: #a9b1d6;">)</span>:
<span style="color: #a9b1d6;">[</span> ?? <span style="color: #a9b1d6;">]</span> Initial channels:
<span style="color: #a9b1d6;">[</span> ** <span style="color: #a9b1d6;">]</span> Enabled network modules <span style="color: #a9b1d6;">[</span>simple_away<span style="color: #a9b1d6;">]</span>
</pre>
</div>

<p>
First, it&rsquo;s important that <code>Listen on port</code> is set to the same port that you exposed in your Docker command. The Docker command only binds the container&rsquo;s port to your hosts port, but the <code>Listen on port</code> is what actually tells ZNC to listen on that port inside the container. Additionally, we want to set <code>Listen using SSL</code> to <code>no</code> because ZNC itself is not going to be handling SSL in our setup, Nginx will do that. ZNC should only be exposed internally on the server, so encryption is not necessary. Finally we need to create an admin user that we will use later to connect to the ZNC web front end. You can set the username and password to whatever you wish, but keep in mind that this will be publicly accessible on the web, so probably avoid something like <code>user: admin pass: so-secret</code>. It is convenient to setup the network settings now because it will be mostly applying default settings, but you can also set it up in the web front end later if you wish.
</p>

<p>
Once this is setup, you can run this command:
</p>
<div class="org-src-container">
<pre class="src src-bash">docker run -d <span style="color: #9ece6a;">\</span>
  --restart unless-stopped <span style="color: #9ece6a;">\</span>
  --name znc-server <span style="color: #9ece6a;">\</span>
  -p 12345:12345 <span style="color: #9ece6a;">\</span>
  -v znc-cfg:/znc-data <span style="color: #9ece6a;">\</span>
  znc
</pre>
</div>

<p>
This command will run ZNC in a Docker container. <code>--restart unless-stopped</code> will make it so the container will automatically restart if the process ends, for example if your server restarts. <code>--name znc-server</code> will name the container. If you don&rsquo;t do this it will still work, but Docker will automatically assign a silly name like <code>wonky_wombat</code> or something. Naming the container makes things easier if you want to make changes later. <code>-p 12345:12345</code> will expose the port 12345 <i>inside</i> the container to the host <i>outside</i> the container. This makes ZNC accessible from outside the container. The ports don&rsquo;t need to be the same, and you can choose whichever port you would like in the available range of non-privileged ports: <code>1024-49151</code>. The main thing is if you have another process running on a port you cannot reuse it, so you have to make sure the port is available. If there is a conflict, you can run <code>lsof -i :12345</code> to check what is running on port 12345 on your host, or more simply just choose a different port. Finally, <code>-v znc-cfg:/znc-data</code> means the container will use the volume we put our configuration file in earlier. If we don&rsquo;t do this, we will lose our configuration data when the container restarts.
</p>
</div>
</div>
<div id="outline-container-orgee5e942" class="outline-2">
<h2 id="orgee5e942">Setting Up Nginx and SSL</h2>
<div class="outline-text-2" id="text-orgee5e942">
<p>
Now that we have ZNC up and running, we need some way to access our ZNC process from outside our server. You can expose ZNC directly to the public internet, but it is common practice to route public traffic through a reverse proxy like Nginx or Caddy and have that handle directing the TCP and HTTP requests to your ZNC server. This also means that Nginx or another reverse proxy will handle SSL instead of ZNC, which is why we said no to SSL encryption in the initial ZNC configuration.
</p>

<p>
Our first step will be to ensure that we have a FQDN (like irc.mysever.com)  pointing to our server. It is possible, but cumbersome to enable SSL without a FQDN, and in most cases not worth the effort. The <a href="https://wiki.znc.in/Reverse_Proxy">ZNC wiki</a> gives two options for this. You can either use a sub domain, for example <code>irc.myerver.com</code>, or you can use a route on an existing domain, such as <code>myserver.com/irc</code>. We are going to use the  sub domain method in our setup. Once the domain is pointed to our server&rsquo;s  IP and the ZNC server is running, we can make a location block like this in our nginx.conf file:
</p>

<div class="org-src-container">
<pre class="src src-nil">server {
    server_name irc.myserver.com;
        location / {
            proxy_pass http://[::1]:12345/;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
}
</pre>
</div>

<p>
This means that any http requests that Nginx gets to <code>irc.myserver.com</code> will be directed to port 12345 on our host machine where ZNC is listening because we added the Docker  <code>-p 12345:12345</code> flag and  we input for <code>Listen on port</code> when you ran <code>znc --makeconf</code> earlier. It will also forward the headers from the original request on to port 12345. Once we have reloaded Nginx and this takes effect, requests should already be routed correctly, but we still need to set up SSL before we can connect the ZNC via HTTP.
</p>

<p>
While Nginx does not have built-in SSL like Caddy, it is fairly easy to set up. <a href="https://certbot.eff.org/">Certbot</a> will setup certificates for us and update our <code>nginx.conf</code> file to point to the correct certificates.
</p>

<p>
At this point, you should be able to access the ZNC web front end, and you can input the username and password you input earlier to access the configuration for your ZNC server, but there is something else we need to do with Nginx. The location block we setup earlier listens specifically for HTTP and HTTPS requests on ports 80 and 443 respectively, which is exactly what the ZNC web front end uses, but the IRC protocol itself uses TCP protocol. Nginx needs a way to appropriately proxy TCP requests to ZNC. Furthermore, since port 443 is the standard port for HTTPS requests, we need  to  configure Nginx to listen for TCP requests on a different port. To do this, we need to create a stream block (you can find the documentation for this <a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/tcp-udp-load-balancer/">here</a>) similar to this:
</p>

<div class="org-src-container">
<pre class="src src-nil">stream {
    upstream znc {
        server [::1]:12345;
    }

    server {
        listen 54321 ssl;
        proxy_pass znc;

        ssl_certificate /etc/letsencrypt/live/irc.domain.dev/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/irc.domain.dev/privkey.pem;
    }
}
</pre>
</div>

<p>
We need to create a <code>stream</code> block that defines a <code>server</code> and <code>upstream</code> block. The <code>server</code> defines the port Nginx will listen on with the  <code>listen</code> directive, which we set to port <code>54321</code> in this example. The <code>listen</code> directive also specifies that we are listening for SSL connections. We can use the same SSL certs that we created for the location block for the web front end earlier by simply copying the directives from our HTTP location block.  The <code>proxy_pass</code> directive passes that request on to the named <code>upstream znc</code> block defined above, which defines the internal port that Nginx should pass the TCP stream on to, 12345. The port defined here must match the port that we bound the Docker container to, which in our case was 12345. You can double check this by running <code>docker ps</code> and then under <code>PORTS</code> you should see something like <code>0.0.0.0:12345-&gt;12345/tcp, [::]:12345-&gt;12345/tcp</code>, which tells us that both IPv4 and IPv6 port 12345 inside the container is bound to the same port on the host. I used different ports, <code>54321</code> and <code>12345</code> here to make the distinction between the two, but they can be the same number. Another way to think of this, is that it&rsquo;s very similar to Docker <code>-p 12345:12345</code>; its binding TCP requests <i>outside</i> our host to the port <i>inside</i> our host.
</p>

<p>
You might need to create a firewall rule to ensure that your firewall is not blocking port <code>54321</code>, or which ever port is defined by your <code>listen</code> directive. For example if you are using <code>ufw</code> you can use the command <code>ufw allow 54321/tcp</code> with root privileges which will allow Nginx to receive TCP requests on port <code>54321</code>.
</p>

<p>
At this point we should be done with the work on the server itself and it&rsquo;s time to do some work on configuring ZNC to talk to an IRC server like Libera.
</p>
</div>
</div>
<div id="outline-container-orge23c769" class="outline-2">
<h2 id="orge23c769">Configuring ZNC</h2>
<div class="outline-text-2" id="text-orge23c769">
<p>
Now that everything is set up on the server, we should be able to navigate to <code>https://irc.myserver.com</code> on the public internet to access our ZNC configuration to do the final bits of work needed to connect to the Libera server.
</p>

<p>
First and foremost, navigate to the <code>Global Settings</code> tab and scroll down to <code>skin</code> select <code>Forest</code>. This is by far and away the most important step so don&rsquo;t skip it!
</p>

<p>
Next, we need to make sure that ZNC is correctly configured to connect to Libera. Select the <code>Your Settings</code> tab and scroll down to the <code>Networks</code> section. If we configured it during the <code>znc --makeconf</code> step, we should see Libera there already. We can click <code>Edit</code> to get further settings. This is where we will input all of the important information we need to log into Libera. Ensure that <code>SSL</code> is ticked and that the port is set correctly to <code>6697</code>, the default port for libera.chat.irc SASL connections. Finally, scroll down to the <code>Modules</code> section and tick the <code>sasl</code> module. Once everything is set, we can select <code>save and return</code> near the bottom of the page.
</p>

<p>
Once we have saved these settings we should see <code>Network Modules (libera)</code> section with a <code>SASL</code> hyperlink. We need to click that and input our Libera Nickname and password. This allows ZNC to connect to Libera via SASL. At this point ZNC should be able to connect to Libera and all that is left is to connect to your ZNC server via Doom Emacs, or another client of your choosing.
</p>
</div>
</div>
<div id="outline-container-org5b934ae" class="outline-2">
<h2 id="org5b934ae">Connecting with Doom Emacs</h2>
<div class="outline-text-2" id="text-org5b934ae">
<p>
On Doom Emacs, to add custom configuration we can use <code>M x doom/open-private-config</code> to open up our personal configuration file. In order to connect to our server, we need to add something like the following:
</p>

<div class="org-src-container">
<pre class="src src-lisp">(after! circe
  (set-irc-server! <span style="color: #9ece6a;">"znc/libera"</span>
    (<span style="color: #bb9af7;">let*</span> ((auth (car (auth-source-search
                       <span style="color: #f7768e;">:host</span> <span style="color: #9ece6a;">"irc.myserver.com"</span>
                       <span style="color: #f7768e;">:port</span> <span style="color: #ff9e64; font-weight: bold;">54321</span>
                       <span style="color: #f7768e;">:user</span> <span style="color: #9ece6a;">"StampChad"</span>
                       <span style="color: #f7768e;">:require</span> '(<span style="color: #f7768e;">:user</span> <span style="color: #f7768e;">:secret</span>))))
           (secret (plist-get auth <span style="color: #f7768e;">:secret</span>)))
      `(<span style="color: #f7768e;">:host</span> <span style="color: #9ece6a;">"irc.myserver.com"</span>
        <span style="color: #f7768e;">:port</span> <span style="color: #ff9e64; font-weight: bold;">54321</span>
        <span style="color: #f7768e;">:tls</span> t
        <span style="color: #f7768e;">:nick</span> <span style="color: #9ece6a;">"StampChad"</span>
        <span style="color: #f7768e;">:pass</span> ,(<span style="color: #bb9af7;">if</span> (functionp secret) (funcall secret) secret)
        <span style="color: #f7768e;">:channels</span> (<span style="color: #9ece6a;">"#stamp-collecting"</span>)))))
</pre>
</div>

<p>
This will connect to our ZNC server at <code>irc.myserver.com</code> port 54321. You might notice that instead of our plain text password, we are getting our password from our <code>authinfo.gpg</code> file. The process of using an authinfo.gpg file is explained in this excellent <a href="https://systemcrafters.net/emacs-tips/using-encrypted-passwords/">blog post</a>. Simply put, you need to ensure you have a gpg key generated by running <code>gpg --full-generate-key</code> and following the prompts and then simply create a file called <code>~/.authinfo.gpg</code> and input your information in the following format:
</p>

<div class="org-src-container">
<pre class="src src-nil">machine irc.myserver.com login StampChad password StampChad/libera:s0-s3cr3t port 54321
</pre>
</div>

<p>
In the above example, the <code>let*</code> binds the return value of <code>auth-source-serach</code> to the <code>secret</code> variable. Instead of  passing our plain text password to <code>:pass</code>, we wrap our Circe config in the <code>let*</code> and then we pass it <code>(if (functionp secret) (funcall secret) secret)</code>. This checks whether <code>auth-source-search</code> returned a function or a string. If it returned a function, <code>(funcall secret)</code> calls <code>secret</code> as a function and returns our password, otherwise it just returns the value of <code>secret</code>, which should be a our password as a string.
</p>
</div>
</div>
<div id="outline-container-org627b2d1" class="outline-2">
<h2 id="org627b2d1">Wrap Up</h2>
<div class="outline-text-2" id="text-org627b2d1">
<p>
And that&rsquo;s it! We should now be able to run <code>M-x =irc</code>, the Doom Emacs command to run Circe, and we are ready to chat. ZNC will stay connected and update us about chat that we have  missed in the channels we are connected to. We can also connect with as many clients we want. There are a lot of ZNC modules to explore and this is really just scratching the service, but getting a basic set up going is a big first step.
</p>
</div>
</div>


</div>

<footer>
  <div>
    <a href="/">Home</a>
    <a href="mailto: chris@chris-hughes.dev">Email</a>
    <div>
      <small>&copy; Chris Hughes 2025</small>
    </div>
  </div>
</footer>

</html>
